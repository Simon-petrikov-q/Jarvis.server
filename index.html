<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto X - Jarvis</title>
    <style>
        body { background-color: #050505; color: #00f2ff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Cabeçalho Tecnológico */
        header { padding: 15px; text-align: center; border-bottom: 2px solid #00f2ff; text-transform: uppercase; letter-spacing: 3px; box-shadow: 0 0 15px #00f2ff55; font-weight: bold; }

        /* Painel de Segurança (Senha) */
        #security-panel { background: #111; padding: 10px; display: flex; justify-content: center; gap: 10px; border-bottom: 1px solid #333; }
        .key-input { background: #000; border: 1px solid #00f2ff; color: #00f2ff; padding: 8px; border-radius: 5px; text-align: center; width: 150px; font-family: monospace; }

        /* Área de Chat */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: radial-gradient(circle, #001a1a 0%, #000 100%); }
        .mensagem { padding: 12px; border-radius: 8px; max-width: 85%; word-wrap: break-word; line-height: 1.4; }
        .user { align-self: flex-end; background: #00f2ff22; border: 1px solid #00f2ff; color: #fff; }
        .jarvis { align-self: flex-start; background: #111; border: 1px solid #555; box-shadow: inset 0 0 5px #00f2ff33; }

        /* Rodapé de Comandos */
        #input-area { padding: 20px; background: #0a0a0a; border-top: 1px solid #333; display: flex; gap: 10px; }
        #campo-texto { flex: 1; background: #000; border: 2px solid #00f2ff; color: #fff; padding: 15px; border-radius: 10px; font-size: 16px; outline: none; }
        #campo-texto:focus { box-shadow: 0 0 15px #00f2ffaa; }
        button { background: #00f2ff; color: #000; border: none; padding: 15px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        button:hover { background: #fff; box-shadow: 0 0 20px #fff; }
    </style>
</head>
<body>
    <header>Sistemas Jarvis - Projeto X</header>

    <div id="security-panel">
        <label style="font-size: 12px;">CHAVE DE ACESSO:</label>
        <input type="password" id="senha-acesso" class="key-input" placeholder="****">
    </div>
    
    <div id="chat-container">
        <div class="mensagem jarvis">Sistemas Online. Aguardando autenticação e comandos, senhor.</div>
    </div>

    <div id="input-area">
        <input type="text" id="campo-texto" placeholder="Escreva o seu comando...">
        <button onclick="enviar()">Enviar</button>
    </div>

    <script>
        const API_URL = "https://jarvis-server-nlp5.onrender.com/chat";
        const usuario_id = "sessao_" + Math.random().toString(36).substr(2, 9); // Cria um ID único para a memória do chat

        async function enviar() {
            const input = document.getElementById('campo-texto');
            const senhaInput = document.getElementById('senha-acesso');
            const container = document.getElementById('chat-container');
            
            const texto = input.value.trim();
            const senha = senhaInput.value.trim();

            if (!texto) return;
            if (!senha) {
                alert("Senhor, a chave de acesso é obrigatória.");
                return;
            }

            // Interface: Adiciona sua fala
            container.innerHTML += `<div class="mensagem user"><b>Senhor:</b> ${texto}</div>`;
            input.value = ""; 
            container.scrollTop = container.scrollHeight;

            try {
                // Envia para o servidor com Senha e ID de Usuário (Memória)
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        mensagem: texto,
                        senha: senha,
                        usuario_id: usuario_id 
                    })
                });

                const data = await response.json();
                
                if (response.status === 403) {
                    container.innerHTML += `<div class="mensagem jarvis" style="border-color: red;"><b>SISTEMA:</b> ${data.resposta}</div>`;
                } else {
                    container.innerHTML += `<div class="mensagem jarvis"><b>Jarvis:</b> ${data.resposta}</div>`;
                }

            } catch (error) {
                container.innerHTML += `<div class="mensagem jarvis" style="color: #ff4444;"><b>Erro:</b> Conexão perdida com o servidor.</div>`;
            }
            container.scrollTop = container.scrollHeight;
        }

        // Atalho Enter
        document.getElementById('campo-texto').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') enviar();
        });
    </script>
</body>
</html>
